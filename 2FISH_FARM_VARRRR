local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local LocalPlayer = Players.LocalPlayer

-- üåç PlaceIds
local PLACE_WORLD_4 = 140403681187145
local PLACE_FISHING = 119454325063278 	--95635359880599
local PLACE_FARM = 95635359880599 		--119454325063278

-- üìÇ ƒê·ªçc file comboEventLog.json an to√†n
local function readComboLog()
	for _ = 1, 3 do
		local success, data = pcall(readfile, "comboEventLog.json")
		if success and data then
			local ok, decoded = pcall(HttpService.JSONDecode, HttpService, data)
			if ok and type(decoded) == "table" then return decoded end
		end
		task.wait(1)
	end
	return nil
end

-- üîÅ Teleport Functions
local function serverhopTo(placeId)
	TeleportService:Teleport(placeId, LocalPlayer)
end

-- üß≠ Main Checker
task.spawn(function()
	while true do
		local logData = readComboLog()
		if not logData then
			warn("‚ö†Ô∏è Kh√¥ng ƒë·ªçc ƒë∆∞·ª£c file comboEventLog.json (3 l·∫ßn).")
			break
		end

		local fishDone = logData.fish and logData.fish.done
		local farmDone = logData.farm and logData.farm.done

		if fishDone and farmDone then
			if game.PlaceId == PLACE_WORLD_4 then
				warn("‚úÖ ƒê√£ ·ªü World4 v√† ƒë·ªß farm+fish. D·ª´ng script.")
				break
			else
				warn("‚úÖ ƒê·ªß farm+fish. Shutdown v√† Kick...")
				game:Shutdown()
				LocalPlayer:Kick("kick_done_2compo")
				break
			end
		elseif game.PlaceId == PLACE_WORLD_4 then
			if not farmDone then
				warn("‚û°Ô∏è Teleport ƒë·∫øn FARM...")
				serverhopTo(PLACE_FARM)
			elseif not fishDone then
				warn("‚û°Ô∏è Teleport ƒë·∫øn FISHING...")
				serverhopTo(PLACE_FISHING)
			else
				warn("‚ö†Ô∏è L·ªói logic kh√¥ng x√°c ƒë·ªãnh.")
			end
		else
			warn("‚è∏ Ch∆∞a ƒë·ªß combo, v√† kh√¥ng ·ªü World4 ‚Üí ch·ªù...")
		end

		task.wait(30)
	end
end)

-- üß® Timeout n·∫øu kh√¥ng v√†o World4 trong 20 ph√∫t
task.spawn(function()
	task.wait(30)
	if game.PlaceId == PLACE_WORLD_4 then return end

	task.wait(30 * 60)

	if game.PlaceId ~= PLACE_WORLD_4 then
		game:Shutdown()
		LocalPlayer:Kick("kickcompo")
	end
end)
