wait(50)
PAUSE_or_SEND = "s"

wait(1)
-- view gÃ³c trÃ¡i
task.spawn(function()

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local Client = ReplicatedStorage:WaitForChild("Library"):WaitForChild("Client")
local SaveModule = require(Client:WaitForChild("Save"))

local previousCounts = {}

-- cáº¥u hÃ¬nh item cáº§n theo dÃµi
local itemsToTrack = {
	
	{ id = "Huge", guiName = "Item3", row = 1, col = 0, color = Color3.fromRGB(0, 255, 255) },			--xanh	trÃ¡i
	{ id = "Titanic", guiName = "Item4", row = 1, col = 1, color = Color3.fromRGB(192,192,192) }, 		--xÃ¡m
	{ id = "Summer Block Party Ticket", guiName = "Item1", row = 0, col = 0, color = Color3.fromRGB(255, 165, 0) },		-- cam
	{ id = "MVP Key", guiName = "Item2", row = 0, col = 1, color = Color3.fromRGB(255, 255, 255) },				--trang
	{ id = "MVP Key Upper Half", guiName = "Item5", row = 0, col = 2, color = Color3.fromRGB(255, 255, 255) },				--trang


}

local function createItemFrame(itemConfig, itemCount)
	local frameSize = 100
	local spacing = 10
	local cols = 2
	local rows = 2

	local offsetX = (itemConfig.col * (frameSize + spacing)) - ((cols - 1) * (frameSize + spacing) / 2)
	local offsetY = (itemConfig.row * (frameSize + spacing)) - ((rows - 1) * (frameSize + spacing) / 2) + 80


	local screenGui = Instance.new("ScreenGui")
	screenGui.Name = itemConfig.guiName
	screenGui.Parent = PlayerGui
	screenGui.ResetOnSpawn = false
	screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

	local frame = Instance.new("Frame")
	frame.Name = "ItemFrame"
	frame.Size = UDim2.new(0, frameSize, 0, frameSize)
	frame.Position = UDim2.new(0.2, offsetX, 1, -offsetY)
	frame.AnchorPoint = Vector2.new(0.5, 1)
	frame.BackgroundColor3 = itemConfig.color
	frame.BorderSizePixel = 2
	frame.Parent = screenGui

	local label = Instance.new("TextLabel")
	label.Size = UDim2.new(1, 0, 1, 0)
	label.BackgroundTransparency = 1
	label.Text = tostring(itemCount)
	label.TextColor3 = Color3.fromRGB(0, 0, 0)
	label.TextScaled = true
	label.Font = Enum.Font.GothamBold
	label.Parent = frame
end

local function checkInventory()
	local inventory = SaveModule.Get().Inventory or {}
	local currentCounts = {}

	-- xÃ³a GUI cÅ©
	for _, item in ipairs(itemsToTrack) do
		local oldGui = PlayerGui:FindFirstChild(item.guiName)
		if oldGui then oldGui:Destroy() end
	end

	for _, item in ipairs(itemsToTrack) do
		local count = 0
		if item.id == "Huge" then
			local pets = inventory.Pet
			for _, pet in pairs(pets) do
				if string.find(pet.id, "Huge") then
					local amount = pet._am or 1
					count = count + amount
				end
			end
		elseif item.id == "Titanic" then
			local pets = inventory.Pet
			for _, pet in pairs(pets) do
				if string.find(pet.id, "Titanic") then
					local amount = pet._am or 1
					count = count + amount
				end
			end	
		else
			for _, group in pairs(inventory) do
				for _, obj in pairs(group) do
					if obj.id == item.id then
						count += (obj._am or 1)
					end
				end
			end			
		end
		
		
		
		currentCounts[item.id] = count
		createItemFrame(item, count)
	end

	previousCounts = currentCounts
end

checkInventory()
while true do
	task.wait(10)
	checkInventory()
end
end)

wait(1)
--Sent chÃ¬a
task.spawn(function()

if PAUSE_or_SEND == "p" then
	return
end

NAME_USER_SEND = "veriotiai779"


function Sent_item_all()

getgenv().Settings_sentitem = {		

["Summer Block Party Ticket"] = {Class = "Misc", Id = "Summer Block Party Ticket",MinAmount = 8000, keepAmount = 7000},	--ok
["MVP Key Upper Half"] = {Class = "Misc", Id = "MVP Key Upper Half", MinAmount = 1000},	--ok
["MVP Key Lower Half"] = {Class = "Misc", Id = "MVP Key Lower Half", MinAmount = 10000},	
--["Tech Key"] = {Class = "Misc", Id = "Tech Key", MinAmount = 1000},	
--["Coins"] = {Class = "Enchant", Id = "Coins", TN = 7, MinAmount = 1000}, 
--["Diamond"] = {Class = "Seed", Id = "Diamond", MinAmount = 2000},
--["Insta Plant Capsule"] = {Class = "Misc", Id = "Insta Plant Capsule", MinAmount = 500},

}

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Client = ReplicatedStorage:WaitForChild("Library"):WaitForChild("Client")
local Network = require(Client.Network)
local SaveData = require(ReplicatedStorage.Library.Client.Save).Get()
local Players = game:GetService("Players")

local player = Players.LocalPlayer
local Inventory = SaveData.Inventory

local itemsFound = {} -- Káº¿t quáº£ tÃ¬m Ä‘Æ°á»£c

-- ğŸ’¬ Danh sÃ¡ch lá»i chÃºc
local messages = {
    "Happy Birthday %s!",
    "Hope today brings %s!",
    "Wishing you luck %s!",
    "Congrats on your %s!",
    "Give away %s!",
    "You are amazing %s"
}

local message = string.format(messages[math.random(1, #messages)], NAME_USER_SEND)	

-- ğŸ”¢ HÃ m chuyá»ƒn Ä‘Æ¡n vá»‹ "100m", "1b" thÃ nh sá»‘
local function parseNumber(str)
	if type(str) == "number" then return str end
	str = str:lower()
	local multipliers = {k = 1e3, m = 1e6, b = 1e9, t = 1e12}
	local num = tonumber(str:match("[%d%.]+")) or 0
	local suffix = str:match("[a-z]+")
	return num * (multipliers[suffix] or 1)
end

-- ğŸ” TÃ¬m item trong Inventory
local function findMatchingItems(class, id, allVariants, requiredTN)
	local results = {}
	local sub = Inventory[class]
	if not sub then return results end

	for uid, v in pairs(sub) do
		if type(v) == "table" and v.id then
			local match = false
			if allVariants then
				match = string.find(v.id, id)
			else
				match = v.id == id
			end

			-- ğŸ” Kiá»ƒm tra thÃªm TN náº¿u cÃ³
			if match then
				if requiredTN == nil or v.tn == requiredTN then
					table.insert(results, {
						UID = uid,
						ID = v.id,
						PT = v.pt,
						SH = v.sh,
						TN = v.tn,
						Count = tonumber(v._am) or 1,
						Class = class,
					})
				end
			end
		end
	end

	return results
end


-- ğŸ“¦ Duyá»‡t qua tá»«ng má»¥c cáº¥u hÃ¬nh
for key, config in pairs(getgenv().Settings_sentitem) do
	local class = config.Class
	local id = config.Id
	local minAmount = parseNumber(config.MinAmount)
	local keepAmount = config.KeepAmount and parseNumber(config.KeepAmount) or 0
	local allVariants = config.AllVariants or false
	wait(2)
	if class == "Currency" then

	for uid, v in pairs(Inventory.Currency) do
		if v.id == id then
			local current = tonumber(v._am) or 0
			local sendAmount = current - keepAmount
			
			if sendAmount >= minAmount then
				print("ğŸ’° Gá»­i currency:", id, "â†’", sendAmount)
				local success, err = pcall(function()
					return Network.Invoke("Mailbox: Send", NAME_USER_SEND, message, "Currency", uid, sendAmount)
				end)
				if not success then
					warn("âŒ Gá»­i currency lá»—i:", err)
				end
				task.wait(2)
			end
		end
	end

	else
    local matched = findMatchingItems(class, id, allVariants, config.TN)

		for _, item in ipairs(matched) do
			local count = item.Count
			local sendCount = count

			if keepAmount > 0 and count > keepAmount then
				sendCount = count - keepAmount
			end

			if sendCount >= minAmount then
	
				print("ğŸ“¦ Gá»­i item:", item.ID, "| SL:", sendCount, "| Loáº¡i:", item.Class)
				local success, err = pcall(function()
					return Network.Invoke("Mailbox: Send", NAME_USER_SEND, message, class, item.UID, sendCount)
				end)
				if not success then
					warn("âŒ Gá»­i item lá»—i:", err)
				end
				task.wait(2)
			end
		end
	end
end

end

Sent_item_all()

end)

wait(1)
-- send pet hiem hoac huge gia cao. Soluong_Yeu_cau = 1 thÃ¬ giá»¯ láº¡i 1 con, khÃ¡c 1 thÃ¬ pháº£i chá» nhiá»u hÆ¡n Soluong_Yeu_cau thÃ¬ má»›i send táº¥t cáº£
task.spawn(function() 
if PAUSE_or_SEND == "p" then
	return
end

getgenv().Settings_sentPET = {
    ["list_pet"] = {

["Palace Pooka"] 	= {Soluong_Yeu_cau = 0},
["Golden Palace Pooka"] 	= {Soluong_Yeu_cau = 0},

["Rose Pooka"] 	= {Soluong_Yeu_cau = 0},
["Golden Rose Pooka"] 	= {Soluong_Yeu_cau = 0},

},
   
}


ds_nguoi_nhan_pet = {"veriotiai779"}


-- HÃ m kiá»ƒm tra tÃªn cÃ³ chá»©a tá»« khÃ³a
function Kiem_tra_ten_co_them_tu_la_(itemName)
    local SH_find = false
    local PT_find = false
    local TN_find = false    
    local category_find = false
	
    -- Kiá»ƒm tra náº¿u itemName cÃ³ tá»« "Shiny"
    if string.find(itemName, "Shiny") then
        SH_find = true
        itemName = string.gsub(itemName, "Shiny ", "") -- Loáº¡i bá» tá»« "Shiny"
        warn("SH_find true")
    end

    -- Kiá»ƒm tra náº¿u itemName cÃ³ tá»« "Golden"
    if string.find(itemName, "Golden") then
        PT_find = 1
        itemName = string.gsub(itemName, "Golden ", "") -- Loáº¡i bá» tá»« "Golden"
        warn("PT_find 1")
    end

    -- Kiá»ƒm tra náº¿u itemName cÃ³ tá»« "Rainbow"
    if string.find(itemName, "Rainbow") then
        PT_find = 2
        itemName = string.gsub(itemName, "Rainbow ", "") -- Loáº¡i bá» tá»« "Rainbow"
        warn("PT_find 2")
    end

    -- Kiá»ƒm tra náº¿u itemName cÃ³ tá»« "Shiny Golden"
    if string.find(itemName, "Shiny Golden") then
        SH_find = true
        PT_find = 1
        itemName = string.gsub(itemName, "Shiny Golden ", "") -- Loáº¡i bá» tá»« "Shiny Golden"
        warn("PT_find 1 SH_find true")
    end

    -- Kiá»ƒm tra náº¿u itemName cÃ³ tá»« "Shiny Rainbow"
    if string.find(itemName, "Shiny Rainbow") then
        SH_find = true
        PT_find = 2
        itemName = string.gsub(itemName, "Shiny Rainbow ", "") -- Loáº¡i bá» tá»« "Shiny Rainbow"
        warn("PT_find 2 SH_find true")
    end

    -- Kiá»ƒm tra náº¿u itemName cÃ³ tá»« "TNx"
    local tnMatch = itemName:match("TN(%d)")  -- TÃ¬m kiáº¿m "TN" kÃ¨m má»™t sá»‘
    if tnMatch then
        TN_find = tonumber(tnMatch)  -- GÃ¡n giÃ¡ trá»‹ cá»§a TN_find
        itemName = string.gsub(itemName, " TN%d", "")  -- Loáº¡i bá» pháº§n "TNx" khá»i itemName
    end

    -- Kiá»ƒm tra category
    if string.find(itemName, "Potion") then
        category_find = "Potion"
        itemName = string.gsub(itemName, "Potion ", "") -- Loáº¡i bá» tá»« "Potion"
        warn("category Potion")
    end
    if string.find(itemName, "Enchant") then
        category_find = "Enchant"
        itemName = string.gsub(itemName, "Enchant ", "") -- Loáº¡i bá» tá»« "Enchant"
        warn("category Enchant")
    end
	if string.find(itemName, "XPPotion") then
        category_find = "XPPotion"
        itemName = string.gsub(itemName, "XPPotion ", "") -- Loáº¡i bá» tá»« "XPPotion"
        warn("category XPPotion")
    end

    -- Tráº£ vá» táº¥t cáº£ cÃ¡c giÃ¡ trá»‹
    return itemName, SH_find, PT_find
end

-- HÃ m tÃ¬m trong tá»«ng báº£ng con cá»§a Inventory
local function findInInventorySubTable(subTable, itemName, PT_find, SH_find)
    if type(subTable) ~= "table" then return end

    -- Sá»­ dá»¥ng string.match Ä‘á»ƒ tÃ¬m chÃ­nh xÃ¡c itemName
    for uid, v in pairs(subTable) do
        if type(v) == "table" and v.id then
            -- Kiá»ƒm tra xem id cÃ³ khá»›p chÃ­nh xÃ¡c vá»›i itemName vÃ  PT_find, SH_find, TN_find
            if string.match(v.id, "^" .. itemName .. "$") then  -- DÃ¹ng string.match Ä‘á»ƒ tÃ¬m pháº§n chuá»—i chÃ­nh xÃ¡c
                local ok = true

                -- Kiá»ƒm tra Ä‘iá»u kiá»‡n PT_find náº¿u cÃ³
                if PT_find ~= false and v.pt ~= PT_find then
                    ok = false
                end
                if PT_find == false and v.pt == 1 then
                    ok = false
                end
                if PT_find == false and v.pt == 2 then
                    ok = false
                end
                -- Kiá»ƒm tra Ä‘iá»u kiá»‡n SH_find náº¿u cÃ³
                if SH_find == true and v.sh == nil then
                    ok = false 
                end
                if SH_find == false and v.sh == true then
                    -- Náº¿u SH_find lÃ  nil thÃ¬ chá»‰ cháº¥p nháº­n v.sh lÃ  nil
                    ok = false
                end

                -- Náº¿u táº¥t cáº£ Ä‘iá»u kiá»‡n Ä‘á»u thá»a mÃ£n, thÃªm vÃ o danh sÃ¡ch
                if ok then
                    table.insert(itemsFound, {
                        UID = uid,
                        ID = v.id,
                        PT = v.pt,
                        SH = v.sh,
                        TN = v.tn,
                        Count = tonumber(v._am) or 1,
                        Category = categoryName  -- ThÃªm category cho tá»«ng má»¥c
                    })
                end
            end
        end
    end
end

-- HÃ m kiá»ƒm tra vÃ  gá»­i pet
local function sendExcessPets()

	local ReplicatedStorage = game:GetService("ReplicatedStorage")
	local Client = ReplicatedStorage:WaitForChild("Library"):WaitForChild("Client")
	local Network = require(Client.Network)
	local SaveData = require(ReplicatedStorage.Library.Client.Save).Get()   

    -- Láº·p qua tá»«ng pet trong list_pet
    for petName, petData in pairs(getgenv().Settings_sentPET["list_pet"]) do
        local itemName = petName
        local requiredAmount = petData.Soluong_Yeu_cau
        local itemName,SH_find, PT_find = Kiem_tra_ten_co_them_tu_la_(itemName)
        
        -- Reset láº¡i danh sÃ¡ch pet
        itemsFound = {}

        -- TÃ¬m trong Inventory
        findInInventorySubTable(SaveData.Inventory.Pet, itemName, PT_find, SH_find)
        
        -- Kiá»ƒm tra sá»‘ lÆ°á»£ng pet cÃ³ sáºµn trong kho
        local totalCount = 0
        for _, item in pairs(itemsFound) do
            if item.ID == itemName then
                totalCount = totalCount + item.Count
            end
        end

        -- Náº¿u sá»‘ lÆ°á»£ng pet cÃ³ trong kho nhiá»u hÆ¡n yÃªu cáº§u, gá»­i pet 
        if totalCount > requiredAmount then
            
            local randomRecipient = ds_nguoi_nhan_pet[math.random(1, #ds_nguoi_nhan_pet)]
            local message = string.format("Happy birthday %s! You received an excess pet: %s", randomRecipient, itemName)

            -- Láº·p qua vÃ  gá»­i pet
            local petSent = 0
            for _, item in pairs(itemsFound) do
				
                if item.ID == itemName and petSent < totalCount then
                    
                    -- Gá»­i pet
					wait(3)
					if string.find(itemName,"Huge") then
						--warn("Huge chi send 1")
						totalCount = 1
					end
					if requiredAmount == 1 then
						--warn("Giá»¯ láº¡i bn con")
						totalCount = totalCount - requiredAmount
					end
                    local success, err = pcall(function()

                        return Network.Invoke("Mailbox: Send", randomRecipient, message, "Pet", item.UID, totalCount)
                    end)
                    if success then
                        warn("âœ… ÄÃ£ gá»­i pet " .. itemName .. " cho " .. randomRecipient .. " vá»›i sá»‘ lÆ°á»£ng " .. totalCount)
                    else
                        warn("âŒ Lá»—i khi gá»­i pet " .. itemName .. ": " .. err)
                    end
                    
                end
            end
        else
            warn("âš ï¸ KhÃ´ng cÃ³ Ä‘á»§ pet " .. itemName .. " trong kho Ä‘á»ƒ gá»­i.")
        end
    end
end

-- Gá»i hÃ m gá»­i pet




while true do

sendExcessPets()
wait(3600)
end


end)

wait(1)
-- ghÃ©p bÃ¬nh mastery tá»« coin7 + key tech
task.spawn(function()

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Client = ReplicatedStorage:WaitForChild("Library"):WaitForChild("Client")
local SaveData = require(Client:WaitForChild("Save")).Get()

-- Remote Craft
local CraftMastery = ReplicatedStorage.Network["XPPotions: Craft"]

-- HÃ m tÃ­nh sá»‘ lÆ°á»£ng craft Ä‘Æ°á»£c
local function checkAndCraft()
    local Inventory = SaveData.Inventory or {}

    -- Láº¥y Diamonds
    local diamonds = 0
    for uid, v in pairs(Inventory.Currency or {}) do
        if v.id == "Diamonds" then
            diamonds = v._am or 0
            break
        end
    end

    -- Láº¥y Tech Key
    local keyTech = 0
    for uid, v in pairs(Inventory.Misc or {}) do
        if v.id == "Tech Key" then
            keyTech += (v._am or 1)
        end
    end

    -- Láº¥y Enchant Coins TN=7
    local coins7 = 0
    for uid, v in pairs(Inventory.Enchant or {}) do
        if v.id == "Coins" and v.tn == 7 then
            coins7 += (v._am or 1)
        end
    end

    print("ğŸ’ Diamonds:", diamonds)
    print("ğŸ”‘ Tech Key:", keyTech)
    print("ğŸ“š Coins TN=7:", coins7)

    -- TÃ­nh sá»‘ Mastery craft Ä‘Æ°á»£c
    local maxByDiamonds = math.floor(diamonds / 150000)
    local maxByCoins = math.floor(coins7 / 12)
    local maxByKeyTech = math.floor(keyTech / 3)

    local craftAmount = math.min(maxByDiamonds, maxByCoins, maxByKeyTech)

    if craftAmount > 0 then
        print("ğŸš€ Báº¯t Ä‘áº§u craft", craftAmount, "bÃ¬nh Mastery...")
        local success, result = pcall(function()
            return CraftMastery:InvokeServer("Mastery", craftAmount)
        end)

        if success then
            print("âœ… Craft thÃ nh cÃ´ng:", craftAmount, "Mastery")
        else
            warn("âŒ Craft tháº¥t báº¡i:", result)
        end
        return true
    else
        print("âš ï¸ KhÃ´ng Ä‘á»§ tÃ i nguyÃªn â†’ chá» 1 giá» rá»“i thá»­ láº¡i...")
        return false
    end
end

-- VÃ²ng láº·p kiá»ƒm tra liÃªn tá»¥c
while true do
    local crafted = checkAndCraft()
    task.wait(3600)
end


end)










